<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Order Food - Luxury Hotel</title>
  <link rel="stylesheet" href="style.css" />
  <script src="config.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap");

    .font-playfair {
      font-family: "Playfair Display", serif;
    }

    .font-inter {
      font-family: "Inter", sans-serif;
    }

    .menu-item {
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .menu-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    }

    .cart-slide {
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }

    .cart-slide.open {
      transform: translateX(0);
    }

    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeIn 0.6s ease forwards;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .bounce-in {
      animation: bounceIn 0.5s ease;
    }

    @keyframes bounceIn {
      0% {
        transform: scale(0.3);
        opacity: 0;
      }

      50% {
        transform: scale(1.05);
      }

      70% {
        transform: scale(0.9);
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      transform: translateX(400px);
      transition: transform 0.3s ease;
    }

    .notification.show {
      transform: translateX(0);
    }
  </style>
</head>

<body class="bg-[#F8F6F3] font-inter">
  <!-- Notification -->
  <div id="notification" class="notification bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg">
    <div class="flex items-center">
      <span class="mr-2">‚úÖ</span>
      <span id="notificationText">Item added to cart!</span>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="bg-white/90 backdrop-blur-md shadow-sm sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center">
          <a href="index.html"
            class="text-2xl font-playfair font-bold text-[#8b1d30] hover:opacity-80 transition-opacity">
            Grand Lynks
          </a>
        </div>
        <div class="hidden md:flex space-x-8">
          <a href="index.html" class="text-gray-700 hover:text-[#b38e2f] transition-colors font-medium">Home</a>
          <a href="#appetizers" class="text-gray-700 hover:text-[#b38e2f] transition-colors">Appetizers</a>
          <a href="#mains" class="text-gray-700 hover:text-[#b38e2f] transition-colors">Main Courses</a>
          <a href="#desserts" class="text-gray-700 hover:text-[#b38e2f] transition-colors">Desserts</a>
          <a href="#beverages" class="text-gray-700 hover:text-[#b38e2f] transition-colors">Beverages</a>
        </div>
        <button id="cartButton"
          class="relative bg-[#8b1d30] text-white px-6 py-2 rounded-full hover:bg-[#6b1524] transition-colors">
          üõí Cart (<span id="cartCount">0</span>)
          <span id="cartBadge"
            class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center hidden">0</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <section class="relative bg-gradient-to-r from-[#8b1d30] to-[#b38e2f] text-white py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="text-5xl font-playfair font-bold mb-6">Delicious Dining</h1>
      <p class="text-xl mb-8 opacity-90 max-w-3xl mx-auto">
        Experience culinary excellence from the comfort of your room or dine
        in our elegant restaurant. Fresh ingredients, expert preparation, and
        exceptional service.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <div class="bg-white/20 backdrop-blur-sm rounded-lg px-6 py-3">
          <span class="text-sm">üöö Room Service Available</span>
        </div>
        <div class="bg-white/20 backdrop-blur-sm rounded-lg px-6 py-3">
          <span class="text-sm">‚è∞ Open 24/7</span>
        </div>
        <div class="bg-white/20 backdrop-blur-sm rounded-lg px-6 py-3">
          <span class="text-sm">üçΩÔ∏è Dine-in Available</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Menu Categories -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Content will be loaded dynamically -->
  </main>




  <!-- Cart Sidebar -->
  <div id="cartSidebar" class="cart-slide fixed top-0 right-0 h-full w-96 bg-white shadow-2xl z-50 overflow-y-auto">
    <div class="p-6 border-b border-gray-200">
      <div class="flex justify-between items-center">
        <h2 class="text-2xl font-playfair font-bold">Your Order</h2>
        <button id="closeCart" class="text-gray-500 hover:text-gray-700 text-2xl">
          &times;
        </button>
      </div>
    </div>

    <div id="cartItems" class="p-6 flex-1">
      <div class="text-center text-gray-500 py-8">
        <span class="text-4xl mb-4 block">üõí</span>
        <p>Your cart is empty</p>
      </div>
    </div>

    <div id="cartFooter" class="border-t border-gray-200 p-6 hidden">
      <div class="mb-4">
        <div class="flex justify-between text-lg font-bold text-gray-900">
          <span>Subtotal:</span>
          <span id="cartSubtotal">‚Ç¶0.00</span>
        </div>
        <div class="flex justify-between text-base font-medium text-gray-800 mt-2">
          <span>Tax (8.5%):</span>
          <span id="cartTax">‚Ç¶0.00</span>
        </div>
        <div class="flex justify-between text-base font-medium text-gray-800 mt-1">
          <span>Delivery Fee:</span>
          <span id="deliveryFee">‚Ç¶1000.00</span>
        </div>
        <div class="border-t border-gray-300 pt-3 mt-3">
          <div class="flex justify-between text-xl font-black text-gray-900">
            <span>Total:</span>
            <span id="cartTotal">‚Ç¶0.00</span>
          </div>
        </div>
      </div>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-bold text-gray-900 mb-2">Delivery Option</label>
          <select id="deliveryOption"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-gray-900 font-medium">
            <option value="room">Room Service (+‚Ç¶1,000)</option>
            <option value="pickup">Restaurant Pickup (Free)</option>
          </select>
        </div>

        <div id="roomNumberDiv">
          <label class="block text-sm font-medium text-gray-700 mb-2">Room Number</label>
          <input type="text" id="roomNumber" placeholder="e.g., 205"
            class="w-full border border-gray-300 rounded-lg px-3 py-2" />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Special Instructions</label>
          <textarea id="specialInstructions" placeholder="Any special requests..."
            class="w-full border border-gray-300 rounded-lg px-3 py-2 h-20 resize-none"></textarea>
        </div>

        <button id="checkoutBtn"
          class="w-full bg-orange-600 text-white py-3 rounded-lg hover:bg-orange-700 transition-colors font-semibold">
          Place Order
        </button>
      </div>
    </div>
  </div>

  <!-- Cart Overlay -->
  <div id="cartOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

  <script>
    let cart = {};
    let cartCount = 0;
    let cartTotal = 0;

    // Show notification
    function showNotification(message, type = "success") {
      const notification = document.getElementById("notification");
      const notificationText = document.getElementById("notificationText");

      notificationText.textContent = message;

      if (type === "success") {
        notification.className =
          "notification bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg";
      } else if (type === "error") {
        notification.className =
          "notification bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg";
      }

      notification.classList.add("show");

      setTimeout(() => {
        notification.classList.remove("show");
      }, 3000);
    }

    // Change quantity
    function changeQuantity(itemId, change) {
      const qtyElement = document.getElementById(itemId + "-qty");
      let currentQty = parseInt(qtyElement.textContent);
      let newQty = Math.max(0, currentQty + change);
      qtyElement.textContent = newQty;
    }

    // Add to cart
    function addToCart(itemId, itemName, price) {
      const qtyElement = document.getElementById(itemId + "-qty");
      const quantity = parseInt(qtyElement.textContent);

      if (quantity === 0) {
        showNotification("Please select a quantity first", "error");
        return;
      }

      if (cart[itemId]) {
        cart[itemId].quantity += quantity;
      } else {
        cart[itemId] = {
          name: itemName,
          price: price,
          quantity: quantity,
        };
      }

      // Reset quantity display
      qtyElement.textContent = "0";

      updateCartDisplay();
      showNotification(`${itemName} added to cart!`);
    }

    // Update cart display
    function updateCartDisplay() {
      cartCount = 0;
      cartTotal = 0;

      Object.values(cart).forEach((item) => {
        cartCount += item.quantity;
        cartTotal += item.price * item.quantity;
      });

      document.getElementById("cartCount").textContent = cartCount;

      const cartBadge = document.getElementById("cartBadge");
      if (cartCount > 0) {
        cartBadge.textContent = cartCount;
        cartBadge.classList.remove("hidden");
      } else {
        cartBadge.classList.add("hidden");
      }

      updateCartSidebar();
    }

    // Update cart sidebar
    function updateCartSidebar() {
      const cartItems = document.getElementById("cartItems");
      const cartFooter = document.getElementById("cartFooter");

      if (cartCount === 0) {
        cartItems.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <span class="text-4xl mb-4 block">üõí</span>
                        <p>Your cart is empty</p>
                    </div>
                `;
        cartFooter.classList.add("hidden");
        return;
      }

      let itemsHTML = "";
      Object.entries(cart).forEach(([itemId, item]) => {
        itemsHTML += `
                    <div class="flex justify-between items-center py-3 border-b border-gray-100">
                        <div class="flex-1">
                            <h4 class="font-medium">${item.name}</h4>
                            <p class="text-sm text-gray-600">‚Ç¶${item.price} each</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="bg-gray-200 hover:bg-gray-300 w-6 h-6 rounded-full flex items-center justify-center text-sm" onclick="updateCartItem('${itemId}', -1)">-</button>
                            <span class="w-8 text-center">${item.quantity}</span>
                            <button class="bg-gray-200 hover:bg-gray-300 w-6 h-6 rounded-full flex items-center justify-center text-sm" onclick="updateCartItem('${itemId}', 1)">+</button>
                            <button class="text-red-500 hover:text-red-700 ml-2" onclick="removeFromCart('${itemId}')">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
      });

      cartItems.innerHTML = itemsHTML;
      cartFooter.classList.remove("hidden");

      // Update totals
      const subtotal = cartTotal;
      const tax = subtotal * 0.085;
      const deliveryOption = document.getElementById("deliveryOption").value;
      const deliveryFee = deliveryOption === "room" ? 1000 : 0;
      const total = subtotal + tax + deliveryFee;

      document.getElementById(
        "cartSubtotal"
      ).textContent = `‚Ç¶${subtotal.toFixed(2)}`;
      document.getElementById("cartTax").textContent = `‚Ç¶${tax.toFixed(2)}`;
      document.getElementById(
        "deliveryFee"
      ).textContent = `‚Ç¶${deliveryFee.toFixed(2)}`;
      document.getElementById("cartTotal").textContent = `‚Ç¶${total.toFixed(
        2
      )}`;
    }

    // Update cart item quantity
    function updateCartItem(itemId, change) {
      if (cart[itemId]) {
        cart[itemId].quantity += change;
        if (cart[itemId].quantity <= 0) {
          delete cart[itemId];
        }
        updateCartDisplay();
      }
    }

    // Remove from cart
    function removeFromCart(itemId) {
      delete cart[itemId];
      updateCartDisplay();
      showNotification("Item removed from cart");
    }

    // Cart sidebar functionality
    document
      .getElementById("cartButton")
      .addEventListener("click", function () {
        document.getElementById("cartSidebar").classList.add("open");
        document.getElementById("cartOverlay").classList.remove("hidden");
      });

    document
      .getElementById("closeCart")
      .addEventListener("click", function () {
        document.getElementById("cartSidebar").classList.remove("open");
        document.getElementById("cartOverlay").classList.add("hidden");
      });

    document
      .getElementById("cartOverlay")
      .addEventListener("click", function () {
        document.getElementById("cartSidebar").classList.remove("open");
        document.getElementById("cartOverlay").classList.add("hidden");
      });

    // Delivery option change
    document
      .getElementById("deliveryOption")
      .addEventListener("change", function () {
        const roomDiv = document.getElementById("roomNumberDiv");
        if (this.value === "room") {
          roomDiv.style.display = "block";
        } else {
          roomDiv.style.display = "none";
        }
        updateCartSidebar();
      });

    // Checkout
    document
      .getElementById("checkoutBtn")
      .addEventListener("click", async function () {
        const deliveryOption =
          document.getElementById("deliveryOption").value;
        const roomNumber = document.getElementById("roomNumber").value;
        const specialInstructions = document.getElementById(
          "specialInstructions"
        ).value;

        if (deliveryOption === "room" && !roomNumber) {
          showNotification("Please enter your room number", "error");
          return;
        }
        // Prepare payload for backend
        const items = Object.values(cart).map((i) => ({
          id: i.id,
          name: i.name,
          price: i.price,
          quantity: i.quantity,
        }));
        const payload = {
          room_id: deliveryOption === "room" ? roomNumber : null,
          guest_name: null,
          items: items.map((i) => `${i.name} x${i.quantity}`).join(", "),
          total_price: items.reduce(
            (sum, i) => sum + i.price * i.quantity,
            0
          ),
          status: "pending",
          notes: specialInstructions || "",
        };

        try {
          const cfg = window.APP_CONFIG || {};
          if (!cfg.USE_MOCK) {
            await fetch(
              (cfg.API_URL || "http://localhost:5000/api") +
              "/room-service-orders",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
              }
            );
          }
          showNotification(
            "Order placed successfully! Estimated delivery: 30-45 minutes"
          );
        } catch (err) {
          showNotification(
            "Could not submit to backend. Please try again.",
            "error"
          );
          return;
        }

        // Reset cart
        cart = {};
        updateCartDisplay();

        // Close cart
        document.getElementById("cartSidebar").classList.remove("open");
        document.getElementById("cartOverlay").classList.add("hidden");

        // Reset form
        document.getElementById("roomNumber").value = "";
        document.getElementById("specialInstructions").value = "";
      });

    // Smooth scrolling for navigation
    document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute("href"));
        if (target) {
          target.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        }
      });
    });

    // Add fade-in animation to menu items
    document.addEventListener("DOMContentLoaded", function () {
      const menuItems = document.querySelectorAll(".menu-item");

      const observer = new IntersectionObserver(
        function (entries) {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("fade-in");
            }
          });
        },
        { threshold: 0.1 }
      );

      menuItems.forEach((item) => {
        observer.observe(item);
      });

      // --- DYNAMIC MENU LOADING ---
      const API_URL = window.APP_CONFIG?.API_URL || "http://localhost:5000/api";

      // Icons for categories (can be extended)
      const categoryIcons = {
        Appetizer: "ü•ó",
        "Main Course": "üçΩÔ∏è",
        Dessert: "üç∞",
        Beverage: "üçπ",
        Breakfast: "üç≥",
        Lunch: "üçî",
        Dinner: "üçñ",
        Soup: "ü•£",
        Food: "üç≤"
      };

      function createMenuItemHTML(item) {
        const itemId = `item-${item.id}`;
        const icon = categoryIcons[item.category] || "üç¥";
        return `
                <div class="menu-item bg-white rounded-2xl shadow-lg overflow-hidden fade-in">
                    <div class="h-48 bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center overflow-hidden">
                        ${item.image ? `<img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover">` : `<span class="text-6xl">${icon}</span>`}
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-playfair font-semibold mb-2">${item.name
          }</h3>
                        <p class="text-gray-600 mb-4 h-16">${item.description || ""
          }</p>
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-2xl font-bold text-[#8b1d30]">‚Ç¶${item.price
          }</span>
                            <div class="flex items-center space-x-2">
                                <button class="quantity-btn bg-gray-200 hover:bg-gray-300 w-8 h-8 rounded-full flex items-center justify-center" onclick="changeQuantity('${itemId}', -1)">-</button>
                                <span id="${itemId}-qty" class="w-8 text-center">0</span>
                                <button class="quantity-btn bg-gray-200 hover:bg-gray-300 w-8 h-8 rounded-full flex items-center justify-center" onclick="changeQuantity('${itemId}', 1)">+</button>
                            </div>
                        </div>
                        <button class="w-full bg-orange-600 text-white py-2 rounded-lg hover:bg-orange-700 transition-colors" onclick="addToCart('${itemId}', '${item.name}', ${item.price})">
                            Add to Cart
                        </button>
                    </div>
                </div>
            `;
      }

      function createSectionHTML(category) {
        const sectionId = category.toLowerCase().replace(/[^a-z0-9]/g, '-');
        const icon = categoryIcons[category] || "üçΩÔ∏è";

        return `
          <section id="${sectionId}" class="mb-16 fade-in">
            <div class="text-center mb-12">
              <h2 class="text-4xl font-playfair font-bold text-gray-800 mb-4">
                ${icon} ${category}
              </h2>
              <p class="text-xl text-gray-600">
                Freshly prepared ${category} for you
              </p>
            </div>
            <div id="${sectionId}-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
          </section>
        `;
      }

      function updateNavigation(categories) {
        const navContainer = document.querySelector('.hidden.md\\:flex.space-x-8');
        if (navContainer) {
          navContainer.innerHTML = categories.map(cat => {
            const sectionId = cat.toLowerCase().replace(/[^a-z0-9]/g, '-');
            return `<a href="#${sectionId}" class="text-gray-700 hover:text-[#b38e2f] transition-colors">${cat}</a>`;
          }).join('');

          // Re-attach smooth scroll
          document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
            anchor.addEventListener("click", function (e) {
              e.preventDefault();
              const target = document.querySelector(this.getAttribute("href"));
              if (target) {
                target.scrollIntoView({
                  behavior: "smooth",
                  block: "start",
                });
              }
            });
          });
        }
      }

      function renderMenu(items) {
        const mainContainer = document.querySelector('main');
        // Group items by category
        const groupedItems = {};

        items.forEach(item => {
          const cat = item.category || 'Uncategorized';
          if (!groupedItems[cat]) groupedItems[cat] = [];
          groupedItems[cat].push(item);
        });

        mainContainer.innerHTML = '';

        Object.keys(groupedItems).sort().forEach(category => {
          const sectionHtml = createSectionHTML(category);
          mainContainer.insertAdjacentHTML('beforeend', sectionHtml);

          const sectionId = category.toLowerCase().replace(/[^a-z0-9]/g, '-');
          const grid = document.getElementById(`${sectionId}-grid`);

          if (grid) {
            groupedItems[category].forEach(item => {
              grid.insertAdjacentHTML("beforeend", createMenuItemHTML(item));
            });
          }
        });

        updateNavigation(Object.keys(groupedItems).sort());
      }

      function showSkeletons() {
        const main = document.querySelector('main');
        if (main) main.innerHTML = '<div class="text-center py-20"><div class="animate-pulse text-2xl text-gray-400">Loading menu...</div></div>';
      }

      async function loadMenu() {
        showSkeletons();
        try {
          const response = await fetch(`${API_URL}/menu`);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const menuItems = await response.json();
          if (menuItems.length > 0) {
            renderMenu(menuItems);
          } else {
            const main = document.querySelector('main');
            if (main) main.innerHTML = '<div class="text-center py-20 text-gray-500">No menu items found.</div>';
          }
        } catch (error) {
          console.error("Failed to load menu:", error);
          const main = document.querySelector('main');
          if (main) main.innerHTML = '<div class="text-center py-20 text-red-500">Could not load menu. Please try again later.</div>';
        }
      }

      loadMenu();
    });
  </script>

</body>

</html>